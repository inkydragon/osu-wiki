**osu!tourney** — клиент для одновременного стриминга всех игроков мультиплеерного матча. Обратите внимание, что для получения доступа к клиенту Вам необходимо:

-   быть организатором турнира;
-   связаться с **tournaments@ppy.sh** и попросить о доступе к турнирному клиенту, а также договориться о проведении матча.

Данный клиент **не предназначен** для личного пользования. Кроме того, не гарантируется его работоспособность при использовании не по назначению, т.е. не для стриминга турниров или игр в мультиплеере.

Если у Вас возникла какая-то проблема при использовании клиента, см. раздел «Решение проблем» (ниже) или **[этот тред](https://osu.ppy.sh/community/forums/topics/327120).**

# Об osu!tourney

osu!tourney — официальный стриминговый клиент, используемый для наблюдения и трансляции всех игроков в мультиплеерной комнате сразу. Поскольку он был создан для мировых турниров ([OWC](RU:OWC_2014 "wikilink")), его функциональность может быть ограничена.

В данный момент клиент поддерживает только командные матчи (2 команды размером до 4 человек). Количество окон жёстко задано, но его можно будет настроить в будущем. Напоминаем, что для работы клиента Вы должны состоять в [группе организаторов турниров](https://osu.ppy.sh/groups/26).

# Получение доступа

После того, как Вы разобрались с организацией своего турнира, отправьте письмо на **tournaments@ppy.sh**, в котором укажите:

1.  Информацию о времени и дате начала и конца турнира;
2.  Ссылку на публично доступную страницу, на которой можно следить за ходом турнира;
3.  Полный список пользователей, которым требуется доступ к osu!tourney;
4.  Что-нибудь ещё, что кажется Вам важным.

Письмо нужно отправить **заранее, минимум за две недели до начала турнира**, чтобы у обеих сторон было время договориться.

На время проведения турнира Вы будете добавлены в [группу организаторов турниров](https://osu.ppy.sh/groups/26), что позволит Вам управлять osu!tourney как через интерфейс, так и по [IRC](RU:IRC "wikilink").

------------------------------------------------------------------------

# Использование

## Установка

Поскольку база данных о картах очень быстро повреждается, **крайне рекомендуется** использовать отдельно установленную копию osu!. Для этого скопируйте osu!.exe в отдельную директорию (да, так можно сделать), создайте там папку Songs и добавьте в неё карты для проведения турнира (напр., содержимое маппулов). По ходу турнира osu!tourney будет скачивать отсутствующие карты. Стоит также обратить внимание, что osu!tourney поддерживает только [опубликованные](RU:Submission "wikilink") карты.

Итак,

1.  Скопируйте `osu!.exe` в отдельную пустую папку и запустите для обновления и докачки остальных файлов.
2.  Запустите новую копию osu! и залогиньтесь, включив сохранение логина и пароля.
3.  Смените ветку обновлений на **экспериментальную (Cutting Edge)**.
4.  Создайте в новой папке с osu! файл `tournament.cfg`
5.  После (пере)запуска osu! откроется окно турнирного клиента, для чего необходимо подождать. В `tournament.cfg` появятся следующие строчки:

`TeamSize` `=` `4`

`privateserver` `=`

`acronym` `=` `Your` `tournament` `name`

`BufferTotalTime` `=` `3000`

`BufferDangerTime` `=` `1000`

`BufferTimeoutTime` `=` `20000`

Закройте osu! и отредактируйте эти параметры так, как Вам нужно.

-   **TeamSize:** размер команд (количество окон для каждой команды). Максимальное значение — 4.
-   **privateserver:** можете не изменять, это Вам не требуется.
-   **acronym:** [акроним](wikipedia:ru:Акроним "wikilink") (краткое название) вашего турнира, например, OWC 2013. Для чего это нужно, описано ниже в разделе «Создание комнаты и управление матчем».
-   **BufferTotalTime:** время в миллисекундах, на которое клиент будет отставать от игрока, чтобы при буферизации не вставать на паузу слишком часто. Рекомендуется не изменять.
-   **BufferDangerTime:** оставшееся в буфере время, при котором клиент будет вставать на паузу, ожидая новых кадров реплея. Рекомендуется не изменять.
-   **BufferTimeoutTime:** время на буферизацию, при превышении которого клиент перестаёт стримить отдельного игрока.

После завершения редактирования `tournament.cfg` перезапустите osu! для применения новых настроек.

## Использование

| Основной интерфейс клиента |
| ----------------------------------------- |
| ![Основной интерфейс клиента](Osutourneymain.png "Основной интерфейс клиента") |

Здесь Вы можете наблюдать интерфейс osu!tourney. Верхняя часть окна разделена на две части, представляющие одну из двух команд в мультиплеере. За наблюдение за каждым слотом мультиплеера отвечает отдельное окошко.

| Игроки распределены по окнам в зависимости от номера их слота в мультиплеере |
| ----------------------------------------------------------------------------------- |
| ![osu!tourney Player Windows](Osutourneywindows.png "osu!tourney Player Windows")   |

Для корректной работы клиента проверьте, что игроки расположились в нужных слотах мультиплеера. Какие слоты являются нужными, описано в разделе «Создание комнаты и управление матчем». Внизу клиента можно наблюдать панель управления.  

| Панель управления osu!tourney |
| ----------------------------------------- |
| ![Панель управления osu!tourney](Osutourneypanel.png "Панель управления osu!tourney") |  

![Вместо инструкций появятся правильно названные комнаты](Osutourneyroomlist.png "Вместо инструкций появятся правильно названные комнаты")

![osu!tourney автоматически расставляет имена команд и пользователей](Osutourneyidle.png "osu!tourney автоматически расставляет имена команд и пользователей")

![Помимо наблюдения, osu!tourney также показывает очки команды и текущую карту](Osutourneyspectate.png "Помимо наблюдения, osu!tourney также показывает очки команды и текущую карту")

![osu!tourney автоматически определяет победителя, следит за счётом и показывает результаты. Окна сфейливших игроков затемнены](Osutourneyresults.png "osu!tourney автоматически определяет победителя, следит за счётом и показывает результаты. Окна сфейливших игроков затемнены")

Здесь написан формат, которому должно следовать название нужной Вам комнаты. Оно состоит из сокращения, которое Вы вписали в `tournament.cfg`, и названий двух команд.

Если в лобби есть хотя бы одна комната с названием, удовлетворяющим этому формату, она появится и на панели управления. Кликните по ней, чтобы подключиться к игрокам; если всё сделано верно, osu!tourney начнёт стримить игру.

По окончании карты osu!tourney добавляет звезду к счёту выигравшей команды. Это можно сделать и **вручную, кликая левой кнопкой по звёздам для добавления звезды или правой для удаления.**

![osu!tourney с добавленной аннотацией](Osutourneywarmup.png "osu!tourney с добавленной аннотацией")

Для показа аннотации нажмите соответствующую кнопку. Сообщение будет помещено вверху экрана, а после завершения карты очки команд не изменятся.

Предназначение кнопок на панели управления:

-   **Sync music:** клиент пытается синхронизировать играющую музыку и хитсаунды.
-   **Toggle annotation:** показывает или скрывает аннотацию (влияет на автоматический подсчёт очков).
-   **Panic:** перезапускает все окна. Пригодится, если одно из окон вдруг прекратило наблюдение или сдохло.
-   **Exit:** останавливает наблюдение за игроками (покидает комнату) или, если Вы ни за кем не наблюдаете, закрывает клиент.

Поля для ввода:

-   **Аннотация:** текст сообщения для показа.
-   **Раунды:** количество звёзд вверху экрана, которое требуется набрать команде для победы.

------------------------------------------------------------------------

# Создание комнаты и управление матчем

## Создание матча

Обратите внимание на формат имени комнаты, это требуется для корректной работы osu!tourney.

Комната должна называться следующим образом: `Сокращение:` `(Команда` `1)` `vs` `(Команда` `2)`

`Сокращение` целиком заменится на то, что Вы указали при редактировании файла настроек в строке `acronym` `=`. Пусть наш матч называется Test Tourney. В таком случае, у комнаты должно быть имя:

`Test` `Tourney:` `(Team` `Name` `1)` `vs` `(Team` `Name` `2)`

Team Name можно поменять на названия команд, главное — не потерять скобки вокруг них.

## Команды IRC

Перед использованием команд убедитесь, что Вы (или тот, кто собирается отправить команду) подключены к серверу через **внешний** IRC-клиент и являетесь членом [группы организаторов турниров](https://osu.ppy.sh/groups/26). Наиболее популярными клиентями являются mIRC, HexChat и HydraIRC; подробней о том, как подключиться через внешний клиент, можно прочесть в [этой статье](RU:IRC "wikilink").

Для получения списка команд отправьте БанчоБоту (BanchoBot) сообщение с текстом `!mp` `help` на номер 4242. Чтобы создать комнату, используйте команду `!mp` `make` `Test` `Tourney:` `(Team` `Name` `1)` `vs` `(Team` `Name` `2)`. Обратите внимание, что созданная таким образом комната обладает двумя свойствами: она останется открытой, даже если все игроки покинут матч, и в неё нельзя попасть извне.

После создания комнаты туда будут автоматически подключены IRC-клиенты организаторов турнира, в неё же стоит отправлять все управляющие команды. По завершении матча используйте команду `!mp` `close` для закрытия комнаты.

Ниже приведён список доступных команд; в <угловых скобках> указаны обязательные аргументы, в [квадратных] — необязательные, сами скобки писать **не надо**. Вместо имени игрока во всех командах можно указывать номер его профиля: `#`*userid* (решётка!). Все пробелы в именах должны быть заменены на нижнее подчёркивание ( `_` ).

-   `!mp` `lock` - заблокировать комнату, после чего игроки не могут переместиться в другой слот или сменить команду.
-   `!mp` `unlock` - снять блокировку
-   `!mp` `size` <size> - количество открытых слотов (1−16).
-   `!mp` `set` <teammode> `[`<scoremode>`]` `[`<size>`]` - настройка режима игры[, критерия победы и размера комнаты].

    `teammode` - 0: Head To Head (все против всех), 1: Tag Coop (по очереди), 2: Team Vs (командный), 3: Tag Team Vs (командный по очереди)

    `scoremode` - 0: Score (очки), 1: Accuracy (точность), 2: Combo (комбо)

-   `!mp` `move` <username> `[`<slot>`]` - добавить игрока в комнату[ в указанный слот]. Если игрок уже находится в комнате, он будет перемещён в указанный слот.
-   `!mp` `host` <username> - передать игроку права хоста.
-   `!mp` `settings` - вывести полную информацию о матче.
-   `!mp` `start` `[`<time>`]` - начать матч через time секунд или, если время не указано, немедленно.
-   `!mp` `abort` - прервать матч.
-   `!mp` `kick` <username> - выкинуть игрока из комнаты.
-   `!mp` `team` <username> <colour> - изменить принадлежность указанного игрока к команде.

    `colour` - red, blue

-   `!mp` `map` <mapid> `[`<playmode>`]` - поменять карту[ и режим игры].

    `playmode` - 0: osu!, 2: Taiko, 3: Catch The Beat, 4: osu!Mania

-   `!mp` `mods` <mod> `[`<mod>`]` `[`<mod>`]` `…` - изменить набор модов на указанный.

    Модов может быть произвольное количество.

    `mod` - HR, DT, FL, HD, FI, Freemod, None

-   `!mp` `timer` `[`<time>`]` - начать обратный отсчёт (30 секунд по умолчанию).

    Оповещения происходят каждую минуту, затем — за 30, 10, 5 и меньше секунд до конца отсчёта.

-   `!mp` `aborttimer` - остановить оба таймера (только что упомянутый обратный отсчёт и отсчёт до начала матча).

Пример настройки матча:

`!mp` `move` `Zallius` `1` - добавить в комнату Заллиуса и поместить его в первый слот.

`!mp` `move` `Loctav` `4` - добавить в комнату Локтава и поместить его в четвёртый слот.

`!mp` `team` `Zallius` `blue` - переместить Заллиуса в синюю команду.

`!mp` `team` `Loctav` `red` - переместить Локтава в красную команду.

`!mp` `set` `0` `2` - выбрать режим игры Head To Head, а условием победы выбрать комбо.

`!mp` `start` - тут же начать матч.

## Управление комнатой

После того, как osu!tourney подключится к комнате, при необходимости распределите игроков по слотам и командам с помощью `!mp` `move` и `!mp` `team`. Как уже упоминалось, каждое окно связано с отдельным слотом комнаты, первая команда займёт левую половину, вторая — правую.

| Соответствие между слотами и окнами |
| ------------------------------------------------------------------------------------- |
| ![osu!tourney Player Assignment](Osutourneyassignment.png "osu!tourney Player Assignment") |

Для простоты восприятия рекомендуется слева всегда располагать синюю команду, а справа — красную.

Обратите внимание: окна osu!tourney привязаны не к цвету команд игроков, а **только** к их положению в комнате. Если игрок показан принадлежащим другой команде, значит, он находится не в своём слоте. Ниже можно видеть расположение слотов для команд из 1−4 человек (окна пронумерованы для ясности):

| TeamSize = 4 |
| -----------------------|
| ![TeamSize = 4](Osutourneywindows.png "TeamSize = 4")   |

| TeamSize = 3 |
| -----------------------|
| ![TeamSize = 3](Teamsize3.png "TeamSize = 3")   |

| TeamSize = 2 |
| -----------------------|
| ![TeamSize = 2](Teamsize2.png "TeamSize = 2")   |

| TeamSize = 1 |
| -----------------------|
| ![TeamSize = 1](Teamsize1.png "TeamSize = 1")   |

## Оформление

![Пример оформления osu!tourney](Osutourneycustom.png "Пример оформления osu!tourney")

Внешний вид osu!tourney можно настроить для соответствия духу вашего турнира. Для этого вам понадобится создать директорию Skin в папке с турнирным клиентом. Полный путь должен выглядеть так: `.../osu!/Skins/User/tournament`. Среди расширений элементов поддерживаются `.jpg`, `.png` и `.mp4`, а сами элементы могут быть названы следующим образом:

-   `background` - постоянный фон osu!tourney.
-   `background-win1` (по желанию) - изображение, на которое постепенно сменится постоянный фон на экране результатов, когда победит команда слева. При покидании экрана результатов оно перейдёт обратно в `background`.
-   `background-win2` (по желанию) - то же самое, но для команды справа.

Оптимальные параметры видео — 1280×720 @ 60fps.

![Эмблемы команд в osu!tourney. Левая эмблема имеет название `Team` `1.png`, правая —`Team` `2.png`](Osutourneyicons.png "Эмблемы команд в osu!tourney. Левая эмблема имеет название Team 1.png, правая —Team 2.png")

osu!tourney может отображать эмблемы команд (напр., флаги стран или аватарки). Для этого эмблемы должны находиться в директории `.../osu!/Skins/User/tournament/icons` и называться в точности так же, как соответствующие команды. К примеру, для матча с названием `Test` `Tourney:` `(Team` `1)` `vs` `(Team` `2)` это будут имена `Team` `1` и `Team` `2`. Допустимые форматы — `.jpg` и `.png`, оптимальное разрешение — 50×50.

Для создания скина к osu!tourney можно использовать .psd-шаблон **[(ссылка для скачивания)](https://osu.ppy.sh/images/tournament/template.zip)**.

------------------------------------------------------------------------

# Вопросы и ответы

**a) Как получить «чистую» установленную копию osu!, не удаляя старую?**

Скопируйте файл `osu!.exe` в пустую папку и запустите его, всё остальное он сделает сам. Это действие может решить многие возможные проблемы; кроме того, для osu!tourney рекомендуется использовать именно отдельную копию osu!.

<!-- -->

**b) У меня сломалось выравнивание окон!**

osu!tourney работает на первичном мониторе и только на нём, поэтому остальные мониторы нужно отключить. Возможно, что текущее разрешение экрана слишком маленькое. Не запускайте osu! с правами администратора, если оно этого не требует, а также проверьте, нет ли обновлений для экспериментальной ветки (Cutting Edge).

<!-- -->

**c) osu!tourney не запускается, выдаёт какую-то ошибку и/или закрывается!**

Проверьте, что Вы находитесь в [группе организаторов турниров](https://osu.ppy.sh/groups/26). Возможно, Ваш доступ закончился вместе с окончанием Вашего турнира. Не забудьте залогиниться в osu! перед переходом в турнирный клиент и сохранить логин и пароль. Проверьте, что в `tournament.cfg` у ключа `privateserver` нет значения (см. образец в начале статьи). Кроме того, см. ответ на предыдущий вопрос.

<!-- -->

**d) База карт повреждена, и при запуске osu! составляет её заново!**

Используйте отдельную копию osu! с минимумом карт.

<!-- -->

**e) Мой фон не работает!**

Проверьте, где он расположен: это должна быть директория `.../osu!/Skins/User/tournament/`, а сам файл должен иметь имя `background.png` (или .jpg). См. раздел «Оформление».

<!-- -->

**f) Как мне перезапустить osu! в обычном режиме?**

Сотрите или переименуйте `tournament.cfg`.

<!-- -->

**g) Стриминг не работает, я ничего не вижу!**

Проверьте, зашли ли Вы в комнату. Кликните по названию комнаты на панели управления: оно должно стать **жирным**. Если стриминг не запустился, нажмите на кнопку **Panic** для перезапуска окон.

<!-- -->

**h) Нужной мне комнаты нет в списке!**

Или комната неверно названа, или Вы вписали неправильное название турнира в `tournament.cfg` (см. раздел «Создание матча»). При данной ошибке комнату надо создать **заново**, переименование ничего не даст.

<!-- -->

**i) Названия команд не показываются!**

См. предыдущий вопрос.

<!-- -->

**j) Как мне правильно постримить турнир на твитч или куда-нибудь ещё?**

Для начала, загляните в [статью о настройке стрима](RU:Live_streaming_osu! "wikilink"). Рекомендованный инструмент — [OBS (Open Broadcaster Software)](https://obsproject.com/). Верхняя часть турнирного клиента имеет разрешение 1280×720, чёрную панель управления стримить **не надо**.

<!-- -->

**k) Моей проблемы или вопроса тут нет, куда обратиться?**

В **[эту тему](https://osu.ppy.sh/community/forums/topics/327120)**, которую читают разработчики. Постарайтесь как можно подробнее описать проблему на английском и, если возможно, приложить скриншоты.
